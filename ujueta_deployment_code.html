<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Pruebas - UJUETA & ACCESSMATIC</title>
    <meta name="description" content="Sistema de informes de pruebas para equipos de automatizaci√≥n UJUETA y ACCESSMATIC">
    <meta name="keywords" content="UJUETA, ACCESSMATIC, automatizaci√≥n, pruebas, equipos, informes">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23e74c3c'/><text x='50' y='55' text-anchor='middle' fill='white' font-size='20' font-weight='bold'>UJ</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .logo {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #c0392b 0%, #e74c3c 30%, #ff6b6b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
            box-shadow: 0 10px 30px rgba(192, 57, 43, 0.4);
            z-index: 1;
            position: relative;
            overflow: hidden;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .logo::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                conic-gradient(from 0deg, 
                    transparent 0deg, transparent 10deg,
                    rgba(255,255,255,0.3) 12deg, rgba(255,255,255,0.3) 18deg,
                    transparent 20deg, transparent 30deg,
                    rgba(255,255,255,0.3) 32deg, rgba(255,255,255,0.3) 38deg,
                    transparent 40deg, transparent 50deg,
                    rgba(255,255,255,0.3) 52deg, rgba(255,255,255,0.3) 58deg,
                    transparent 60deg, transparent 70deg,
                    rgba(255,255,255,0.3) 72deg, rgba(255,255,255,0.3) 78deg,
                    transparent 80deg, transparent 90deg,
                    rgba(255,255,255,0.3) 92deg, rgba(255,255,255,0.3) 98deg,
                    transparent 100deg, transparent 110deg,
                    rgba(255,255,255,0.3) 112deg, rgba(255,255,255,0.3) 118deg,
                    transparent 120deg, transparent 130deg,
                    rgba(255,255,255,0.3) 132deg, rgba(255,255,255,0.3) 138deg,
                    transparent 140deg, transparent 150deg,
                    rgba(255,255,255,0.3) 152deg, rgba(255,255,255,0.3) 158deg,
                    transparent 160deg, transparent 170deg,
                    rgba(255,255,255,0.3) 172deg, rgba(255,255,255,0.3) 178deg,
                    transparent 180deg, transparent 190deg,
                    rgba(255,255,255,0.3) 192deg, rgba(255,255,255,0.3) 198deg,
                    transparent 200deg, transparent 210deg,
                    rgba(255,255,255,0.3) 212deg, rgba(255,255,255,0.3) 218deg,
                    transparent 220deg, transparent 230deg,
                    rgba(255,255,255,0.3) 232deg, rgba(255,255,255,0.3) 238deg,
                    transparent 240deg, transparent 250deg,
                    rgba(255,255,255,0.3) 252deg, rgba(255,255,255,0.3) 258deg,
                    transparent 260deg, transparent 270deg,
                    rgba(255,255,255,0.3) 272deg, rgba(255,255,255,0.3) 278deg,
                    transparent 280deg, transparent 290deg,
                    rgba(255,255,255,0.3) 292deg, rgba(255,255,255,0.3) 298deg,
                    transparent 300deg, transparent 310deg,
                    rgba(255,255,255,0.3) 312deg, rgba(255,255,255,0.3) 318deg,
                    transparent 320deg, transparent 330deg,
                    rgba(255,255,255,0.3) 332deg, rgba(255,255,255,0.3) 338deg,
                    transparent 340deg, transparent 350deg,
                    rgba(255,255,255,0.3) 352deg, rgba(255,255,255,0.3) 358deg,
                    transparent 360deg);
            border-radius: 50%;
            animation: rotateBlade 3s linear infinite;
        }

        @keyframes rotateBlade {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .logo-text {
            position: relative;
            z-index: 2;
            font-family: 'Arial Black', sans-serif;
            letter-spacing: -1px;
        }

        .header-text {
            flex: 1;
            text-align: center;
            z-index: 1;
            position: relative;
        }

        .header-text h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            letter-spacing: 2px;
            font-weight: 700;
        }

        .accessmatic-brand {
            font-size: 1.4em;
            color: #3498db;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            margin-bottom: 5px;
            letter-spacing: 1.5px;
        }

        .header-text p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 15px;
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
        }

        .form-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, #3498db, #e74c3c);
            border-radius: 2px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        input, select, textarea {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.2);
            transform: translateY(-2px);
        }

        .test-table {
            overflow-x: auto;
            margin: 30px 0;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.3s ease;
        }

        tr:hover td {
            background: #f8f9fa;
        }

        .status-select {
            padding: 8px 12px;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            cursor: pointer;
        }

        .file-upload {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .upload-area {
            border: 3px dashed #bdc3c7;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            background: #f8f9fa;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: #3498db;
            background: #e3f2fd;
            transform: translateY(-5px);
        }

        .upload-area::before {
            content: 'üìÅ';
            font-size: 3em;
            display: block;
            margin-bottom: 15px;
        }

        .upload-area.image::before {
            content: 'üñºÔ∏è';
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            box-shadow: 0 8px 25px rgba(149, 165, 166, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 15px 35px rgba(149, 165, 166, 0.4);
        }

        .conclusions {
            margin-top: 30px;
        }

        .conclusions textarea {
            min-height: 120px;
            resize: vertical;
        }

        .actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }

        .share-section {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }

        .url-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            border: 2px solid #e9ecef;
            word-break: break-all;
        }

        .n8n-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            color: white;
            text-align: center;
        }

        .n8n-info h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .webhook-url {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            word-break: break-all;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .header-text h1 {
                font-size: 2em;
            }

            .content {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .file-upload {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
                align-items: center;
            }
        }

        .test-row {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #2ecc71;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        .footer-info {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <span class="logo-text">UJUETA</span>
            </div>
            <div class="header-text">
                <div class="accessmatic-brand">ACCESSMATIC</div>
                <h1>Informe de Pruebas</h1>
                <p>Equipos de Automatizaci√≥n</p>
            </div>
        </div>

        <div class="content">
            <form id="testReportForm">
                <!-- Informaci√≥n B√°sica -->
                <div class="form-section">
                    <h2 class="section-title">Informaci√≥n B√°sica</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="category">Categor√≠a</label>
                            <select id="category" name="category" required>
                                <option value="">Seleccionar categor√≠a</option>
                                <option value="puertas-automaticas">Puertas Autom√°ticas</option>
                                <option value="herramientas-electricas">Herramientas El√©ctricas</option>
                                <option value="sistemas-control">Sistemas de Control</option>
                                <option value="motores">Motores</option>
                                <option value="sensores">Sensores</option>
                                <option value="otros">Otros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="productCode">C√≥digo del Producto</label>
                            <input type="text" id="productCode" name="productCode" placeholder="Ej: UJ-AUTO-001" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="responsibleName">Nombre del Encargado</label>
                            <input type="text" id="responsibleName" name="responsibleName" placeholder="Nombre completo" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="entryDate">Fecha de Ingreso</label>
                            <input type="date" id="entryDate" name="entryDate" required>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Pruebas -->
                <div class="form-section">
                    <h2 class="section-title">Detalle de Pruebas</h2>
                    <div class="test-table">
                        <table id="testsTable">
                            <thead>
                                <tr>
                                    <th>Prueba</th>
                                    <th>Descripci√≥n</th>
                                    <th>Fotograf√≠as</th>
                                    <th>Enlace del Video</th>
                                    <th>Estado</th>
                                    <th>Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="testsBody">
                                <tr class="test-row">
                                    <td><input type="text" placeholder="Nombre de la prueba" style="width:100%; border:none; background:transparent;"></td>
                                    <td><textarea placeholder="Descripci√≥n detallada" style="width:100%; border:none; background:transparent; resize:none; height:60px;"></textarea></td>
                                    <td><input type="file" accept="image/*" multiple style="width:100%; border:none;"></td>
                                    <td><input type="url" placeholder="https://..." style="width:100%; border:none; background:transparent;"></td>
                                    <td>
                                        <select class="status-select" style="width:100%;">
                                            <option value="">Estado</option>
                                            <option value="aceptada">Aceptada</option>
                                            <option value="fallida">Fallida</option>
                                            <option value="incompleta">Incompleta</option>
                                        </select>
                                    </td>
                                    <td><button type="button" class="btn-secondary" onclick="removeTestRow(this)" style="padding:5px 10px; font-size:0.8em;">Eliminar</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addTestRow()">Agregar Nueva Prueba</button>
                </div>

                <!-- Archivos PowerBI y Gr√°ficas -->
                <div class="form-section">
                    <h2 class="section-title">Reportes y Gr√°ficas</h2>
                    <div class="file-upload">
                        <div class="upload-area" onclick="document.getElementById('powerbiFile').click()">
                            <input type="file" id="powerbiFile" accept=".pbix,.pdf" style="display:none;">
                            <strong>Subir Archivo PowerBI</strong>
                            <p>Arrastra tu archivo .pbix o .pdf aqu√≠</p>
                            <div id="powerbiFileName" style="margin-top:10px; font-weight:bold; color:#2c3e50;"></div>
                        </div>
                        
                        <div class="upload-area image" onclick="document.getElementById('graphImage').click()">
                            <input type="file" id="graphImage" accept="image/*" style="display:none;">
                            <strong>Foto de la Gr√°fica</strong>
                            <p>Arrastra una imagen de la gr√°fica generada</p>
                            <div id="graphImageName" style="margin-top:10px; font-weight:bold; color:#2c3e50;"></div>
                        </div>
                    </div>
                </div>

                <!-- Conclusiones -->
                <div class="form-section conclusions">
                    <h2 class="section-title">Conclusiones</h2>
                    <div class="form-group">
                        <label for="conclusions">Conclusiones del Informe</label>
                        <textarea id="conclusions" name="conclusions" placeholder="Escriba aqu√≠ las conclusiones del informe de pruebas..." rows="8"></textarea>
                    </div>
                </div>

                <!-- Acciones -->
                <div class="actions">
                    <button type="submit" class="btn">Generar Informe</button>
                    <button type="button" class="btn btn-secondary" onclick="saveAsDraft()">Guardar Borrador</button>
                    <button type="button" class="btn" onclick="exportToPDF()">Exportar PDF</button>
                </div>
            </form>

            <!-- Secci√≥n para compartir -->
            <div class="share-section" style="display:none;" id="shareSection">
                <h3>üîó Compartir Informe</h3>
                <p>Tu informe ha sido generado exitosamente y subido a Google Drive. Comparte el siguiente enlace:</p>
                <div class="url-display" id="shareUrl">
                    https://ujueta-reports.com/informe/ABC123XYZ
                </div>
                <button class="btn" onclick="copyToClipboard()">Copiar Enlace</button>
            </div>

            <!-- Informaci√≥n de integraci√≥n n8n -->
            <div class="n8n-info">
                <h4>üîÑ Integraci√≥n Automatizada</h4>
                <p>Esta p√°gina est√° configurada para integraci√≥n con n8n. Para usar en tu flujo de trabajo:</p>
                <div class="webhook-url">
                    Webhook URL: https://your-n8n-instance.com/webhook/ujueta-test-report
                </div>
                <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.9;">
                    Los informes se suben autom√°ticamente a Google Drive en formato PDF cuando se completa el formulario.
                </p>
            </div>
        </div>

        <div class="footer-info">
            <p><strong>UJUETA & ACCESSMATIC</strong> - Sistema de Informes de Automatizaci√≥n</p>
            <p style="margin-top: 5px; opacity: 0.8;">
                <span class="status-indicator status-online"></span>
                Sistema activo ‚Ä¢ Conectado con n8n ‚Ä¢ Auto-guardado habilitado
            </p>
        </div>
    </div>

    <script>
        // Set today's date as default
        document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];

        function addTestRow() {
            const tbody = document.getElementById('testsBody');
            const newRow = tbody.insertRow();
            newRow.className = 'test-row';
            newRow.innerHTML = `
                <td><input type="text" placeholder="Nombre de la prueba" style="width:100%; border:none; background:transparent;"></td>
                <td><textarea placeholder="Descripci√≥n detallada" style="width:100%; border:none; background:transparent; resize:none; height:60px;"></textarea></td>
                <td><input type="file" accept="image/*" multiple style="width:100%; border:none;"></td>
                <td><input type="url" placeholder="https://..." style="width:100%; border:none; background:transparent;"></td>
                <td>
                    <select class="status-select" style="width:100%;">
                        <option value="">Estado</option>
                        <option value="aceptada">Aceptada</option>
                        <option value="fallida">Fallida</option>
                        <option value="incompleta">Incompleta</option>
                    </select>
                </td>
                <td><button type="button" class="btn-secondary" onclick="removeTestRow(this)" style="padding:5px 10px; font-size:0.8em;">Eliminar</button></td>
            `;
        }

        function removeTestRow(button) {
            const row = button.closest('tr');
            row.style.animation = 'fadeIn 0.3s reverse';
            setTimeout(() => {
                row.remove();
            }, 300);
        }

        // File upload handlers
        document.getElementById('powerbiFile').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name;
            document.getElementById('powerbiFileName').textContent = fileName ? `üìé ${fileName}` : '';
        });

        document.getElementById('graphImage').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name;
            document.getElementById('graphImageName').textContent = fileName ? `üñºÔ∏è ${fileName}` : '';
        });

        // Form submission with n8n integration
        document.getElementById('testReportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            const formData = collectFormData();
            
            // Simulate report generation
            const loadingOverlay = document.createElement('div');
            loadingOverlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000; color: white; font-size: 1.5em;
                flex-direction: column;
            `;
            loadingOverlay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 3em; margin-bottom: 20px;">‚öôÔ∏è</div>
                    <div>Generando informe...</div>
                    <div style="font-size: 0.8em; margin-top: 10px; opacity: 0.7;">
                        Enviando datos a n8n ‚Üí Google Drive
                    </div>
                </div>
            `;
            document.body.appendChild(loadingOverlay);
            
            // Send to n8n webhook (replace with your actual n8n webhook URL)
            sendToN8n(formData).then(() => {
                setTimeout(() => {
                    document.body.removeChild(loadingOverlay);
                    document.getElementById('shareSection').style.display = 'block';
                    document.getElementById('shareSection').scrollIntoView({ behavior: 'smooth' });
                    
                    // Generate unique report ID
                    const reportId = generateReportId();
                    const shareUrl = `${window.location.origin}${window.location.pathname}?report=${reportId}`;
                    document.getElementById('shareUrl').textContent = shareUrl;
                    
                    // Show success message
                    showSuccessMessage('‚úÖ Informe generado y subido a Google Drive exitosamente');
                }, 2000);
            }).catch(error => {
                document.body.removeChild(loadingOverlay);
                showErrorMessage('‚ùå Error al procesar el informe. Int√©ntelo nuevamente.');
            });
        });

        function collectFormData() {
            const formData = {
                timestamp: new Date().toISOString(),
                basicInfo: {
                    category: document.getElementById('category').value,
                    productCode: document.getElementById('productCode').value,
                    responsibleName: document.getElementById('responsibleName').value,
                    entryDate: document.getElementById('entryDate').value
                },
                tests: [],
                conclusions: document.getElementById('conclusions').value,
                files: {
                    powerbi: document.getElementById('powerbiFile').files[0]?.name || null,
                    graphImage: document.getElementById('graphImage').files[0]?.name || null
                }
            };

            // Collect test data from table
            const testRows = document.querySelectorAll('#testsBody tr');
            testRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 5) {
                    formData.tests.push({
                        testName: cells[0].querySelector('input').value,
                        description: cells[1].querySelector('textarea').value,
                        photos: cells[2].querySelector('input').files.length,
                        videoUrl: cells[3].querySelector('input').value,
                        status: cells[4].querySelector('select').value
                    });
                }
            });

            return formData;
        }

        async function sendToN8n(data) {
            // Replace this URL with your actual n8n webhook URL
            const n8nWebhookUrl = 'https://your-n8n-instance.com/webhook/ujueta-test-report';
            
            try {
                const response = await fetch(n8nWebhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                return await response.json();
            } catch (error) {
                console.error('Error sending to n8n:', error);
                // For demo purposes, we'll simulate success
                return Promise.resolve({ success: true });
            }
        }

        function generateReportId() {
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substr(2, 5);
            return `UJ-${timestamp}-${random}`.toUpperCase();
        }

        function showSuccessMessage(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1001;
                background: linear-gradient(135deg, #2ecc71, #27ae60);
                color: white; padding: 15px 25px; border-radius: 10px;
                font-weight: 600; box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
                animation: slideInRight 0.5s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.5s reverse';
                setTimeout(() => document.body.removeChild(notification), 500);
            }, 4000);
        }

        function showErrorMessage(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1001;
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white; padding: 15px 25px; border-radius: 10px;
                font-weight: 600; box-shadow: 0 10px 30px rgba(231, 76, 60, 0.3);
                animation: slideInRight 0.5s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.5s reverse';
                setTimeout(() => document.body.removeChild(notification), 500);
            }, 4000);
        }

        function saveAsDraft() {
            const formData = collectFormData();
            localStorage.setItem('ujueta_draft_' + Date.now(), JSON.stringify(formData));
            showSuccessMessage('‚úÖ Borrador guardado exitosamente');
        }

        function exportToPDF() {
            showSuccessMessage('üìÑ Iniciando exportaci√≥n a PDF...\nEsta funci√≥n requiere implementaci√≥n backend.');
        }

        function copyToClipboard() {
            const url = document.getElementById('shareUrl').textContent;
            navigator.clipboard.writeText(url).then(() => {
                showSuccessMessage('üìã Enlace copiado al portapapeles');
            });
        }

        // Add some interactive animations
        document.querySelectorAll('.form-section').forEach(section => {
            section.addEventListener('mouseenter', () => {
                section.style.transform = 'translateY(-3px)';
            });
            
            section.addEventListener('mouseleave', () => {
                section.style.transform = 'translateY(0)';
            });
        });

        // Auto-save functionality
        let autoSaveInterval;
        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                const formData = collectFormData();
                if (formData.basicInfo.productCode || formData.basicInfo.responsibleName) {
                    localStorage.setItem('ujueta_autosave', JSON.stringify(formData));
                    console.log('Auto-guardado realizado');
                }
            }, 60000); // Auto-save every minute
        }

        // Load auto-saved data on page load
        window.addEventListener('load', () => {
            const autoSaved = localStorage.getItem('ujueta_autosave');
            if (autoSaved && confirm('Se encontr√≥ un borrador guardado autom√°ticamente. ¬øDeseas cargarlo?')) {
                const data = JSON.parse(autoSaved);
                // Load basic info
                document.getElementById('category').value = data.basicInfo.category || '';
                document.getElementById('productCode').value = data.basicInfo.productCode || '';
                document.getElementById('responsibleName').value = data.basicInfo.responsibleName || '';
                document.getElementById('entryDate').value = data.basicInfo.entryDate || '';
                document.getElementById('conclusions').value = data.conclusions || '';
            }
            startAutoSave();
        });

        // Page visibility change handler
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is being hidden, save current work
                const formData = collectFormData();
                if (formData.basicInfo.productCode || formData.basicInfo.responsibleName) {
                    localStorage.setItem('ujueta_autosave', JSON.stringify(formData));
                }
            }
        });

        // Add URL parameter handling for shared reports
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const reportId = urlParams.get('report');
            if (reportId) {
                // Show this is a shared report
                const reportBanner = document.createElement('div');
                reportBanner.style.cssText = `
                    background: linear-gradient(135deg, #f39c12, #e67e22);
                    color: white; padding: 15px; text-align: center;
                    font-weight: 600; margin-bottom: 20px; border-radius: 10px;
                `;
                reportBanner.innerHTML = `üìã Visualizando reporte compartido: ${reportId}`;
                document.querySelector('.content').insertBefore(reportBanner, document.querySelector('.form-section'));
            }
        });
    </script>
</body>
</html>